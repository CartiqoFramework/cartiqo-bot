generator clientGlobal {
    provider = "prisma-client-js"
    output   = "../../packages/core/prisma/global"
}

datasource global_db {
    provider = "mysql"
    url      = env("DATABASE_URL_GLOBAL")
}

// NOT GUILDS THAT THE BOT IS IN, BUT SUPPORT GUILDS WHERE PEOPLE CAN GET SUPPORTog hva 
model SupportGuilds {
    guildId      String        @unique
    guildName    String
    language     String        @default("en-US")
    category     GuildCategory @default(COMMUNITY)
    logChannelId String?
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    StaffUsers   StaffUsers[]
}

enum GuildCategory {
    LANGUAGE
    COMMUNITY
    HEAD_SUPPORT
}

model StaffUsers {
    id       Int     @id @default(autoincrement())
    guildId  String
    userId   String
    username String?

    role        StaffRoles @default(Trial_Moderator)
    departments Json? // store ["Appeals", "Reports", "Stachio"] 

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    guild SupportGuilds @relation(fields: [guildId], references: [guildId])
}

enum StaffRoles {
    Owner
    Senior_Administrator
    Administrator
    Trial_Administrator
    Senior_Moderator
    Moderator
    Trial_Moderator
}

model CartiqoUser {
    id            String       @id @default(cuid())
    discordId     String       @unique
    username      String?
    premiumActive Boolean      @default(false)
    premiumTier   CartiqoTier  @default(Free)
    linkedCodeId  String?      @unique
    linkedCode    CartiqoCode? @relation(fields: [linkedCodeId], references: [id])
    createdAt     DateTime     @default(now())
    updatedAt     DateTime     @updatedAt
}

model CartiqoCode {
    id          String       @id @default(cuid())
    code        String       @unique
    tier        CartiqoTier
    duration    Int?
    createdAt   DateTime     @default(now())
    redeemed    Boolean      @default(false)
    redeemedAt  DateTime?
    redeemedBy  String? // Discord ID of redeemer
    cartiqoUser CartiqoUser?
}

enum CartiqoTier {
    Free
    CartiqoPlus
}

model CartiqoGuild {
    guildId           String      @unique
    guildName         String?
    createdAt         DateTime    @default(now())
    updatedAt         DateTime    @updatedAt
    tier              CartiqoTier @default(Free)
    expiresAt         DateTime?
    activeCode        String?
    activatedByUserId String?
}
